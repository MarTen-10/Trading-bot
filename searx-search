#!/usr/bin/env bash
set -euo pipefail

if [[ $# -lt 1 ]]; then
  echo "Usage: searx-search \"query\" [count]"
  exit 1
fi

QUERY="$1"
COUNT="${2:-5}"
BASE_URL="${SEARXNG_URL:-http://127.0.0.1:18080}"

ENCODED_QUERY=$(python3 -c 'import sys, urllib.parse; print(urllib.parse.quote_plus(sys.argv[1]))' "$QUERY")

curl -sS "${BASE_URL}/search?q=${ENCODED_QUERY}&format=json" \
  | python3 -c 'import json,sys
count=int(sys.argv[1])
raw=sys.stdin.read().strip()
if not raw:
    print("No response from SearXNG")
    raise SystemExit(1)
data=json.loads(raw)
results=data.get("results",[])[:count]
if not results:
    print("No results")
    raise SystemExit(0)
for i,r in enumerate(results,1):
    title=(r.get("title") or "(no title)").strip()
    url=r.get("url") or ""
    engine=r.get("engine") or ""
    print(f"{i}. {title}")
    if url: print(f"   {url}")
    if engine: print(f"   [{engine}]")' "$COUNT"
